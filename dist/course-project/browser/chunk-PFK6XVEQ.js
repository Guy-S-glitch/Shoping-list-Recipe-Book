import{U as p,f as h,g as n,j as T,k as s,n as u,o as d,q as c,sa as m}from"./chunk-NGME7X53.js";T();var o=class{constructor(r,g,e,t){this.email=r,this.id=g,this._token=e,this._tokenExpirationDate=t}get token(){return!this._token||new Date>this._tokenExpirationDate?null:this._token}};var l={firebaseAPIKey:"AIzaSyDecGu6eqpU9ZPHhNq3jTJ3CdPkAH8zSbE"};var O=(()=>{let r=class r{constructor(e,t){this.http=e,this.router=t,this.user=new h(null)}signUp(e,t){return this.http.post("https://identitytoolkit.googleapis.com/v1/accounts:signUp?key="+l.firebaseAPIKey,{email:e,password:t,returnSecureToken:!0}).pipe(s(this.HandleError),u(this.HandleAuthentication))}signIn(e,t){return this.http.post("https://identitytoolkit.googleapis.com/v1/accounts:signInWithPassword?key="+l.firebaseAPIKey,{email:e,password:t,returnSecureToken:!0}).pipe(s(this.HandleError),u(a=>this.HandleAuthentication(a)))}logOut(){this.user.next(null),this.router.navigate(["./auth"]),localStorage.removeItem("userData"),this.tokenExperationTimer&&clearTimeout(this.tokenExperationTimer),this.tokenExperationTimer=null}autoLogOut(e){console.log(e),this.tokenExperationTimer=setTimeout(()=>{this.logOut()},e)}autoLogin(){let e=JSON.parse(localStorage.getItem("userData"));if(!e)return;let t=new o(e.email,e.id,e._token,new Date(e._tokenExpirationDate));t.token&&(this.user.next(t),this.autoLogOut(new Date(e._tokenExpirationDate).getTime()-new Date().getTime()))}HandleAuthentication(e){let t=new Date(new Date().getTime()+ +e.expiresIn*1e3),a=new o(e.email,e.localId,e.idToken,t);this.user.next(a),this.autoLogOut(+e.expiresIn*1e3),localStorage.setItem("userData",JSON.stringify(a))}HandleError(e){console.log(e);let t="unknown error occurred";if(!(e.error&&e.error.error))return n(t);switch(e.error.error.message){case"EMAIL_EXISTS":t="The email address is already in use by another account.";break;case"OPERATION_NOT_ALLOWED":t="Password sign-in is disabled for this project.";break;case"TOO_MANY_ATTEMPTS_TRY_LATER":t=" We have blocked all requests from this device due to unusual activity. Try again later.";case"EMAIL_NOT_FOUND":t="There is no user record corresponding to this identifier. The user may have been deleted.";break;case"INVALID_PASSWORD":t="The password is invalid or the user does not have a password.";break;case"USER_DISABLED":t="The user account has been disabled by an administrator.";break;case"TOO_MANY_ATTEMPTS_TRY_LATER : Access to this account has been temporarily disabled due to many failed login attempts. You can immediately restore it by resetting your password or you can try again later.":t="Access to this account has been temporarily disabled due to many failed login attempts. You can immediately restore it by resetting your password or you can try again later.";break}return n(t)}};r.\u0275fac=function(t){return new(t||r)(c(p),c(m))},r.\u0275prov=d({token:r,factory:r.\u0275fac,providedIn:"root"});let i=r;return i})();export{O as a};
